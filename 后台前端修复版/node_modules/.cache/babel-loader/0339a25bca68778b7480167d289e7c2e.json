{"remainingRequest":"C:\\Users\\Administrator\\Desktop\\验收文件0516\\后台前端\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\Administrator\\Desktop\\验收文件0516\\后台前端\\src\\auth\\authService.js","dependencies":[{"path":"C:\\Users\\Administrator\\Desktop\\验收文件0516\\后台前端\\src\\auth\\authService.js","mtime":1620826038000},{"path":"C:\\Users\\Administrator\\Desktop\\验收文件0516\\后台前端\\babel.config.js","mtime":1620826038000},{"path":"C:\\Users\\Administrator\\Desktop\\验收文件0516\\后台前端\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664268236462},{"path":"C:\\Users\\Administrator\\Desktop\\验收文件0516\\后台前端\\node_modules\\babel-loader\\lib\\index.js","mtime":1663908471338}],"contextDependencies":[],"result":["import \"core-js/modules/es6.reflect.construct\";\nimport \"core-js/modules/es6.date.now\";\nimport \"core-js/modules/es6.array.index-of\";\nimport \"core-js/modules/es6.string.sub\";\nimport \"core-js/modules/es6.function.name\";\nimport _classCallCheck from \"C:/Users/Administrator/Desktop/\\u9A8C\\u6536\\u6587\\u4EF60516/\\u540E\\u53F0\\u524D\\u7AEF/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"C:/Users/Administrator/Desktop/\\u9A8C\\u6536\\u6587\\u4EF60516/\\u540E\\u53F0\\u524D\\u7AEF/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _assertThisInitialized from \"C:/Users/Administrator/Desktop/\\u9A8C\\u6536\\u6587\\u4EF60516/\\u540E\\u53F0\\u524D\\u7AEF/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";\nimport _inherits from \"C:/Users/Administrator/Desktop/\\u9A8C\\u6536\\u6587\\u4EF60516/\\u540E\\u53F0\\u524D\\u7AEF/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _possibleConstructorReturn from \"C:/Users/Administrator/Desktop/\\u9A8C\\u6536\\u6587\\u4EF60516/\\u540E\\u53F0\\u524D\\u7AEF/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js\";\nimport _getPrototypeOf from \"C:/Users/Administrator/Desktop/\\u9A8C\\u6536\\u6587\\u4EF60516/\\u540E\\u53F0\\u524D\\u7AEF/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js\";\nimport _defineProperty from \"C:/Users/Administrator/Desktop/\\u9A8C\\u6536\\u6587\\u4EF60516/\\u540E\\u53F0\\u524D\\u7AEF/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport auth0 from 'auth0-js';\nimport EventEmitter from 'events';\nimport authConfig from '@/../auth_config.json';\nimport store from '@/store/store.js'; // 'loggedIn' is used in other parts of application. So, Don't forget to change there also\n\nvar localStorageKey = 'loggedIn';\nvar tokenExpiryKey = 'tokenExpiry';\nvar loginEvent = 'loginEvent';\nvar webAuth = new auth0.WebAuth({\n  domain: authConfig.domain,\n  redirectUri: \"\".concat(window.location.origin + process.env.BASE_URL, \"callback\"),\n  clientID: authConfig.clientId,\n  responseType: 'id_token',\n  scope: 'openid profile email'\n});\n\nvar AuthService = /*#__PURE__*/function (_EventEmitter) {\n  _inherits(AuthService, _EventEmitter);\n\n  var _super = _createSuper(AuthService);\n\n  function AuthService() {\n    var _this;\n\n    _classCallCheck(this, AuthService);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"idToken\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"profile\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"tokenExpiry\", null);\n\n    return _this;\n  }\n\n  _createClass(AuthService, [{\n    key: \"login\",\n    value: // Starts the user login flow\n    function login(customState) {\n      webAuth.authorize({\n        appState: customState\n      });\n    } // Handles the callback request from Auth0\n\n  }, {\n    key: \"handleAuthentication\",\n    value: function handleAuthentication() {\n      var _this2 = this;\n\n      return new Promise(function (resolve, reject) {\n        webAuth.parseHash(function (err, authResult) {\n          if (err) {\n            alert(\"\".concat(err.error, \". Detailed error can be found in console.\"));\n            reject(err);\n          } else {\n            _this2.localLogin(authResult);\n\n            resolve(authResult.idToken);\n          }\n        });\n      });\n    }\n  }, {\n    key: \"localLogin\",\n    value: function localLogin(authResult) {\n      this.idToken = authResult.idToken;\n      this.profile = authResult.idTokenPayload; // Convert the JWT expiry time from seconds to milliseconds\n\n      this.tokenExpiry = new Date(this.profile.exp * 1000);\n      localStorage.setItem(tokenExpiryKey, this.tokenExpiry);\n      localStorage.setItem(localStorageKey, 'true');\n      store.commit('UPDATE_USER_INFO', {\n        displayName: this.profile.name,\n        email: this.profile.email,\n        photoURL: this.profile.picture,\n        providerId: this.profile.sub.substr(0, this.profile.sub.indexOf('|')),\n        uid: this.profile.sub\n      });\n      this.emit(loginEvent, {\n        loggedIn: true,\n        profile: authResult.idTokenPayload,\n        state: authResult.appState || {}\n      });\n    }\n  }, {\n    key: \"renewTokens\",\n    value: function renewTokens() {\n      var _this3 = this;\n\n      // reject can be used as parameter in promise for using reject\n      return new Promise(function (resolve) {\n        if (localStorage.getItem(localStorageKey) !== 'true') {// return reject(\"Not logged in\");\n        }\n\n        webAuth.checkSession({}, function (err, authResult) {\n          if (err) {// reject(err);\n          } else {\n            _this3.localLogin(authResult);\n\n            resolve(authResult);\n          }\n        });\n      });\n    }\n  }, {\n    key: \"logOut\",\n    value: function logOut() {\n      localStorage.removeItem(localStorageKey);\n      localStorage.removeItem(tokenExpiryKey);\n      localStorage.removeItem('userInfo');\n      this.idToken = null;\n      this.tokenExpiry = null;\n      this.profile = null;\n      webAuth.logout({\n        returnTo: window.location.origin + process.env.BASE_URL\n      });\n      this.emit(loginEvent, {\n        loggedIn: false\n      });\n    }\n  }, {\n    key: \"isAuthenticated\",\n    value: function isAuthenticated() {\n      return new Date(Date.now()) < new Date(localStorage.getItem(tokenExpiryKey)) && localStorage.getItem(localStorageKey) === 'true';\n    }\n  }]);\n\n  return AuthService;\n}(EventEmitter);\n\nexport default new AuthService();",{"version":3,"names":["auth0","EventEmitter","authConfig","store","localStorageKey","tokenExpiryKey","loginEvent","webAuth","WebAuth","domain","redirectUri","window","location","origin","process","env","BASE_URL","clientID","clientId","responseType","scope","AuthService","customState","authorize","appState","Promise","resolve","reject","parseHash","err","authResult","alert","error","localLogin","idToken","profile","idTokenPayload","tokenExpiry","Date","exp","localStorage","setItem","commit","displayName","name","email","photoURL","picture","providerId","sub","substr","indexOf","uid","emit","loggedIn","state","getItem","checkSession","removeItem","logout","returnTo","now"],"sources":["C:/Users/Administrator/Desktop/验收文件0516/后台前端/src/auth/authService.js"],"sourcesContent":["import auth0 from 'auth0-js'\r\nimport EventEmitter from 'events'\r\nimport authConfig from '@/../auth_config.json'\r\n\r\nimport store from '@/store/store.js'\r\n\r\n// 'loggedIn' is used in other parts of application. So, Don't forget to change there also\r\nconst localStorageKey = 'loggedIn'\r\n\r\nconst tokenExpiryKey = 'tokenExpiry'\r\nconst loginEvent = 'loginEvent'\r\n\r\nconst webAuth = new auth0.WebAuth({\r\n  domain: authConfig.domain,\r\n  redirectUri: `${window.location.origin + process.env.BASE_URL}callback`,\r\n  clientID: authConfig.clientId,\r\n  responseType: 'id_token',\r\n  scope: 'openid profile email'\r\n})\r\n\r\nclass AuthService extends EventEmitter {\r\n    idToken = null;\r\n    profile = null;\r\n    tokenExpiry = null;\r\n\r\n    // Starts the user login flow\r\n    login (customState) {\r\n      webAuth.authorize({\r\n        appState: customState\r\n      })\r\n    }\r\n\r\n    // Handles the callback request from Auth0\r\n    handleAuthentication () {\r\n      return new Promise((resolve, reject) => {\r\n        webAuth.parseHash((err, authResult) => {\r\n          if (err) {\r\n            alert(`${err.error}. Detailed error can be found in console.`)\r\n            reject(err)\r\n          } else {\r\n            this.localLogin(authResult)\r\n            resolve(authResult.idToken)\r\n          }\r\n        })\r\n      })\r\n    }\r\n\r\n    localLogin (authResult) {\r\n      this.idToken = authResult.idToken\r\n      this.profile = authResult.idTokenPayload\r\n\r\n      // Convert the JWT expiry time from seconds to milliseconds\r\n      this.tokenExpiry = new Date(this.profile.exp * 1000)\r\n      localStorage.setItem(tokenExpiryKey, this.tokenExpiry)\r\n      localStorage.setItem(localStorageKey, 'true')\r\n\r\n      store.commit('UPDATE_USER_INFO', {\r\n        displayName: this.profile.name,\r\n        email: this.profile.email,\r\n        photoURL: this.profile.picture,\r\n        providerId: this.profile.sub.substr(0, this.profile.sub.indexOf('|')),\r\n        uid: this.profile.sub\r\n      })\r\n\r\n      this.emit(loginEvent, {\r\n        loggedIn: true,\r\n        profile: authResult.idTokenPayload,\r\n        state: authResult.appState || {}\r\n      })\r\n    }\r\n\r\n    renewTokens () {\r\n      // reject can be used as parameter in promise for using reject\r\n      return new Promise((resolve) => {\r\n        if (localStorage.getItem(localStorageKey) !== 'true') {\r\n          // return reject(\"Not logged in\");\r\n        }\r\n\r\n        webAuth.checkSession({}, (err, authResult) => {\r\n          if (err) {\r\n            // reject(err);\r\n          } else {\r\n            this.localLogin(authResult)\r\n            resolve(authResult)\r\n          }\r\n        })\r\n      })\r\n    }\r\n\r\n    logOut () {\r\n      localStorage.removeItem(localStorageKey)\r\n      localStorage.removeItem(tokenExpiryKey)\r\n      localStorage.removeItem('userInfo')\r\n\r\n      this.idToken = null\r\n      this.tokenExpiry = null\r\n      this.profile = null\r\n\r\n      webAuth.logout({\r\n        returnTo: window.location.origin + process.env.BASE_URL\r\n      })\r\n\r\n      this.emit(loginEvent, { loggedIn: false })\r\n    }\r\n\r\n    isAuthenticated () {\r\n      return (\r\n        new Date(Date.now()) < new Date(localStorage.getItem(tokenExpiryKey)) &&\r\n            localStorage.getItem(localStorageKey) === 'true'\r\n      )\r\n    }\r\n}\r\n\r\nexport default new AuthService()\r\n"],"mappings":"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"}]}