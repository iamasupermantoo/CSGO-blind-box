{"remainingRequest":"D:\\Program Files (x86)\\wechat\\WeChat Files\\wxid_ue0ca48wn2m522\\FileStorage\\File\\2022-09\\盲盒源码\\后台前端\\node_modules\\thread-loader\\dist\\cjs.js!D:\\Program Files (x86)\\wechat\\WeChat Files\\wxid_ue0ca48wn2m522\\FileStorage\\File\\2022-09\\盲盒源码\\后台前端\\node_modules\\babel-loader\\lib\\index.js!D:\\Program Files (x86)\\wechat\\WeChat Files\\wxid_ue0ca48wn2m522\\FileStorage\\File\\2022-09\\盲盒源码\\后台前端\\src\\http\\requests\\auth\\jwt\\index.js","dependencies":[{"path":"D:\\Program Files (x86)\\wechat\\WeChat Files\\wxid_ue0ca48wn2m522\\FileStorage\\File\\2022-09\\盲盒源码\\后台前端\\src\\http\\requests\\auth\\jwt\\index.js","mtime":1620826038000},{"path":"D:\\Program Files (x86)\\wechat\\WeChat Files\\wxid_ue0ca48wn2m522\\FileStorage\\File\\2022-09\\盲盒源码\\后台前端\\babel.config.js","mtime":1620826038000},{"path":"D:\\Program Files (x86)\\wechat\\WeChat Files\\wxid_ue0ca48wn2m522\\FileStorage\\File\\2022-09\\盲盒源码\\后台前端\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664268236462},{"path":"D:\\Program Files (x86)\\wechat\\WeChat Files\\wxid_ue0ca48wn2m522\\FileStorage\\File\\2022-09\\盲盒源码\\后台前端\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1664268237683},{"path":"D:\\Program Files (x86)\\wechat\\WeChat Files\\wxid_ue0ca48wn2m522\\FileStorage\\File\\2022-09\\盲盒源码\\后台前端\\node_modules\\babel-loader\\lib\\index.js","mtime":1663908471338}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.filter\";\nimport axios from \"../../../axios/index.js\";\nimport store from \"../../../../store/store.js\"; // Token Refresh\n\nvar isAlreadyFetchingAccessToken = false;\nvar subscribers = [];\n\nfunction onAccessTokenFetched(access_token) {\n  subscribers = subscribers.filter(function (callback) {\n    return callback(access_token);\n  });\n}\n\nfunction addSubscriber(callback) {\n  subscribers.push(callback);\n}\n\nexport default {\n  init: function init() {\n    axios.interceptors.response.use(function (response) {\n      return response;\n    }, function (error) {\n      // const { config, response: { status } } = error\n      var config = error.config,\n          response = error.response;\n      var originalRequest = config; // if (status === 401) {\n\n      if (response && response.status === 401) {\n        if (!isAlreadyFetchingAccessToken) {\n          isAlreadyFetchingAccessToken = true;\n          store.dispatch('auth/fetchAccessToken').then(function (access_token) {\n            isAlreadyFetchingAccessToken = false;\n            onAccessTokenFetched(access_token);\n          });\n        }\n\n        var retryOriginalRequest = new Promise(function (resolve) {\n          addSubscriber(function (access_token) {\n            originalRequest.headers.Authorization = \"Bearer \".concat(access_token);\n            resolve(axios(originalRequest));\n          });\n        });\n        return retryOriginalRequest;\n      }\n\n      return Promise.reject(error);\n    });\n  },\n  login: function login(email, pwd) {\n    return axios.post('/api/auth/login', {\n      email: email,\n      password: pwd\n    });\n  },\n  registerUser: function registerUser(name, email, pwd) {\n    return axios.post('/api/auth/register', {\n      displayName: name,\n      email: email,\n      password: pwd\n    });\n  },\n  refreshToken: function refreshToken() {\n    return axios.post('/api/auth/refresh-token', {\n      accessToken: localStorage.getItem('accessToKen')\n    });\n  }\n};",{"version":3,"names":["axios","store","isAlreadyFetchingAccessToken","subscribers","onAccessTokenFetched","access_token","filter","callback","addSubscriber","push","init","interceptors","response","use","error","config","originalRequest","status","dispatch","then","retryOriginalRequest","Promise","resolve","headers","Authorization","reject","login","email","pwd","post","password","registerUser","name","displayName","refreshToken","accessToken","localStorage","getItem"],"sources":["D:/Program Files (x86)/wechat/WeChat Files/wxid_ue0ca48wn2m522/FileStorage/File/2022-09/盲盒源码/后台前端/src/http/requests/auth/jwt/index.js"],"sourcesContent":["import axios from '../../../axios/index.js'\r\nimport store from '../../../../store/store.js'\r\n\r\n// Token Refresh\r\nlet isAlreadyFetchingAccessToken = false\r\nlet subscribers = []\r\n\r\nfunction onAccessTokenFetched (access_token) {\r\n  subscribers = subscribers.filter(callback => callback(access_token))\r\n}\r\n\r\nfunction addSubscriber (callback) {\r\n  subscribers.push(callback)\r\n}\r\n\r\nexport default {\r\n  init () {\r\n    axios.interceptors.response.use(function (response) {\r\n      return response\r\n    }, function (error) {\r\n      // const { config, response: { status } } = error\r\n      const { config, response } = error\r\n      const originalRequest = config\r\n\r\n      // if (status === 401) {\r\n      if (response && response.status === 401) {\r\n        if (!isAlreadyFetchingAccessToken) {\r\n          isAlreadyFetchingAccessToken = true\r\n          store.dispatch('auth/fetchAccessToken')\r\n            .then((access_token) => {\r\n              isAlreadyFetchingAccessToken = false\r\n              onAccessTokenFetched(access_token)\r\n            })\r\n        }\r\n\r\n        const retryOriginalRequest = new Promise((resolve) => {\r\n          addSubscriber(access_token => {\r\n            originalRequest.headers.Authorization = `Bearer ${access_token}`\r\n            resolve(axios(originalRequest))\r\n          })\r\n        })\r\n        return retryOriginalRequest\r\n      }\r\n      return Promise.reject(error)\r\n    })\r\n  },\r\n  login (email, pwd) {\r\n    return axios.post('/api/auth/login', {\r\n      email,\r\n      password: pwd\r\n    })\r\n  },\r\n  registerUser (name, email, pwd) {\r\n    return axios.post('/api/auth/register', {\r\n      displayName: name,\r\n      email,\r\n      password: pwd\r\n    })\r\n  },\r\n  refreshToken () {\r\n    return axios.post('/api/auth/refresh-token', {accessToken: localStorage.getItem('accessToKen')})\r\n  }\r\n}\r\n"],"mappings":";AAAA,OAAOA,KAAP;AACA,OAAOC,KAAP,mC,CAEA;;AACA,IAAIC,4BAA4B,GAAG,KAAnC;AACA,IAAIC,WAAW,GAAG,EAAlB;;AAEA,SAASC,oBAAT,CAA+BC,YAA/B,EAA6C;EAC3CF,WAAW,GAAGA,WAAW,CAACG,MAAZ,CAAmB,UAAAC,QAAQ;IAAA,OAAIA,QAAQ,CAACF,YAAD,CAAZ;EAAA,CAA3B,CAAd;AACD;;AAED,SAASG,aAAT,CAAwBD,QAAxB,EAAkC;EAChCJ,WAAW,CAACM,IAAZ,CAAiBF,QAAjB;AACD;;AAED,eAAe;EACbG,IADa,kBACL;IACNV,KAAK,CAACW,YAAN,CAAmBC,QAAnB,CAA4BC,GAA5B,CAAgC,UAAUD,QAAV,EAAoB;MAClD,OAAOA,QAAP;IACD,CAFD,EAEG,UAAUE,KAAV,EAAiB;MAClB;MACA,IAAQC,MAAR,GAA6BD,KAA7B,CAAQC,MAAR;MAAA,IAAgBH,QAAhB,GAA6BE,KAA7B,CAAgBF,QAAhB;MACA,IAAMI,eAAe,GAAGD,MAAxB,CAHkB,CAKlB;;MACA,IAAIH,QAAQ,IAAIA,QAAQ,CAACK,MAAT,KAAoB,GAApC,EAAyC;QACvC,IAAI,CAACf,4BAAL,EAAmC;UACjCA,4BAA4B,GAAG,IAA/B;UACAD,KAAK,CAACiB,QAAN,CAAe,uBAAf,EACGC,IADH,CACQ,UAACd,YAAD,EAAkB;YACtBH,4BAA4B,GAAG,KAA/B;YACAE,oBAAoB,CAACC,YAAD,CAApB;UACD,CAJH;QAKD;;QAED,IAAMe,oBAAoB,GAAG,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAa;UACpDd,aAAa,CAAC,UAAAH,YAAY,EAAI;YAC5BW,eAAe,CAACO,OAAhB,CAAwBC,aAAxB,oBAAkDnB,YAAlD;YACAiB,OAAO,CAACtB,KAAK,CAACgB,eAAD,CAAN,CAAP;UACD,CAHY,CAAb;QAID,CAL4B,CAA7B;QAMA,OAAOI,oBAAP;MACD;;MACD,OAAOC,OAAO,CAACI,MAAR,CAAeX,KAAf,CAAP;IACD,CA3BD;EA4BD,CA9BY;EA+BbY,KA/Ba,iBA+BNC,KA/BM,EA+BCC,GA/BD,EA+BM;IACjB,OAAO5B,KAAK,CAAC6B,IAAN,CAAW,iBAAX,EAA8B;MACnCF,KAAK,EAALA,KADmC;MAEnCG,QAAQ,EAAEF;IAFyB,CAA9B,CAAP;EAID,CApCY;EAqCbG,YArCa,wBAqCCC,IArCD,EAqCOL,KArCP,EAqCcC,GArCd,EAqCmB;IAC9B,OAAO5B,KAAK,CAAC6B,IAAN,CAAW,oBAAX,EAAiC;MACtCI,WAAW,EAAED,IADyB;MAEtCL,KAAK,EAALA,KAFsC;MAGtCG,QAAQ,EAAEF;IAH4B,CAAjC,CAAP;EAKD,CA3CY;EA4CbM,YA5Ca,0BA4CG;IACd,OAAOlC,KAAK,CAAC6B,IAAN,CAAW,yBAAX,EAAsC;MAACM,WAAW,EAAEC,YAAY,CAACC,OAAb,CAAqB,aAArB;IAAd,CAAtC,CAAP;EACD;AA9CY,CAAf"}]}